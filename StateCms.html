<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CMS System</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <script src="js/jquery-2.2.4.min.js"></script>
    <script src="js/react.js"></script>
    <script src="js/react-dom.min.js"></script>
    <script src="js/browser.min.js"></script>
    <style type="text/css">
        .btn{
            margin-right:2px;
        }
    </style>
  </head>
    <body>
        <div id="CmsApp"></div>
        <script type="text/babel" src="StateCms/Navigation.js"></script>
        <script type="text/babel" src="StateCms/ReadState.js"></script>
        <script type="text/babel" src="StateCms/ShowAllState.js"></script>
        <script type="text/babel" src="StateCms/createState.js"></script>
        <script type="text/babel">
        
            
            

            var EditState = React.createClass({
                getInitialState:function(){
                    return({
                        StateId:this.props.StateId,
                        StateInfo:[],
                        StateName:'',
                        Status:'',
                        Error:'',
                        Success:'',

                    })
                },
                componentDidMount(){
                    var dataString = 'StateId='+ this.state.StateId;

                $.ajax({
                    url: "http://localhost/oceangreen/admin/api/readOneState.php",
                    type : "POST",
                    data:dataString,
                    cache: false,
                    success: function(html)
                        {
                            //alert(html);
                            this.setState({StateInfo:JSON.parse(html)});
                            if(this.state.StateInfo){
                                    this.setState({
                                        StateName:this.state.StateInfo.location_name,
                                        Status:this.state.StateInfo.active,
                                    })
                                }
                            //alert(this.state.StateName);

                                
                            
                            //this.setState({StateInfo:html});
                            //alert("first"+this.state.StateInfo);

                        }.bind(this),
                });

                

            },
            OnStateNameChange:function(e){
                //alert(e.target.value);
                this.setState({
                    StateName: e.target.value,
                })
            },
            OnStatusChange:function(e){
                //alert(e.target.value);
                this.setState({
                    Status: e.target.value,
                })
            },
            UpdateState:function(){
                //alert("State Name : "+this.state.StateName+
                     // "Status is:"+this.state.Status);
                     this.setState({
                         Success:'',
                         Error:'',
                     })
                      var dataString = 'StateId='+ this.state.StateId+'&statName='+this.state.StateName+'&status='+this.state.Status;

                $.ajax({
                    url: "http://localhost/oceangreen/admin/api/UpdateState.php",
                    type : "POST",
                    data:dataString,
                    cache: false,
                    success: function(html)
                        {
                            //alert(html);
                            if(html=='Success'){
                                this.setState({
                                    Success: this.state.StateName+' is Edited',
                                })
                            }
                            if(html=='NoNeed'){
                                this.setState({
                                    Error:'No Need to Edit',
                                })
                            }
                            if(html=='SomethingWentWrong'){
                                this.setState({
                                    Error:'Something Went Wrong. Contact developer',
                                })
                            }
                            

                        }.bind(this),
                });
            },
                render:function(){
                    //alert(StateInfo);
                    
                   
                    
                    
                    return(
                        <div className="panel panel-primary">
                            <div className="panel-heading">
                                Edit {this.state.StateName} 
                            </div>
                            <div className="panel-body">
                                <div className="col-md-6">
                                    {this.state.Error
                                        ?<div className='alert alert-danger'>{this.state.Error}</div>
                                        :null
                                    }
                                    {this.state.Success
                                        ?<div className='alert alert-success'>{this.state.Success}</div>
                                        :null
                                    }
                                    <form>
                                            
                                            <div  className="form-group">
                                                <label for="Statename">State Name</label>
                                                <input onChange={this.OnStateNameChange} value={this.state.StateName} type="text" className="form-control" id="StateName" placeholder="State Name"/>
                                            </div>
                                            <div className="form-group">
                                                <label for="status">status</label>
                                                {
                                                       <select onChange={this.OnStatusChange} value={this.state.Status} className="form-control">
                                                        <option value="1">Active</option>
                                                        <option value="0">De-active</option>
                                                        </select>
                                                        
                                                    
                                                }
                                                
                                            </div>
                                            
                                            <div className="form-group">
                                                    <button onClick={this.UpdateState}type="button" className="btn btn-primary btn-sm">Update {this.state.StateName}</button>
                                                    <button onClick={()=>this.props.ChangeAppMode('Read',null)} type="button" className="btn btn-warning btn-sm">Cancel</button>
                                            </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )
                },
            });

        
            var StartPage = React.createClass({
                getInitialState:function(){
                    return({
                        AppMode:'Read',
                        StateId:'',
                    })
                },

                ChangeAppMode:function(text,StateId){
                    
                    this.setState({AppMode:text})
                    if(StateId){
                        this.setState({StateId:StateId})
                    }else{
                        this.setState({StateId:'',})
                    }
                    //alert("AppMode is "+this.state.AppMode+" StateId is"+this.state.StateId);
                },
                render:function(){
                    var ToRender = <ReadState ChangeAppMode={this.ChangeAppMode}/>;
                    switch (this.state.AppMode) {
                        case 'Create': ToRender = <CreateState ChangeAppMode={this.ChangeAppMode}/>;
                            break;
                        case 'Edit'  : ToRender = <EditState ChangeAppMode={this.ChangeAppMode} StateId={this.state.StateId}/>;
                            break;
                        case 'Delete': ToRender = <DeleteState ChangeAppMode={this.ChangeAppMode } StateId={this.state.StateId}/>;
                        default:
                            break;
                    }
                    return (
                        <div>
                                {<Nevigation/>}
                            <div className="container">
                                <div className="row">
                                    <div className="col-md-8 col-md-offset-2">
                                        {ToRender}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )
                        
                }
            });
            ReactDOM.render(<StartPage/>,document.getElementById('CmsApp'));
        </script>
    </body>
</html>