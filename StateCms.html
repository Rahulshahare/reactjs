<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CMS System</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <script src="js/jquery-2.2.4.min.js"></script>
    <script src="js/react.js"></script>
    <script src="js/react-dom.min.js"></script>
    <script src="js/browser.min.js"></script>
    <style type="text/css">
        .btn{
            margin-right:2px;
        }
    </style>
  </head>
    <body>
        <div id="CmsApp"></div>
        
        <script type="text/babel">
        var Nevigation = React.createClass({
            render:function(){
                return(
                    <nav className="navbar navbar-default">
                        <div className="container-fluid">    
                            <a className="navbar-brand newFont" href="#">Instagram</a>
                        </div>
                    </nav>
                );
            }
        });
            var ShowAllState = React.createClass({

                getInitialState:function(){
                    return({
                        Delete:'Delete',
                        btn1:'btn btn-xs btn-warning',
                        btn2:'btn btn-xs btn-danger hide',
                        btn3:'btn btn-xs btn-info hide',
                    })
                },
                OnDeleteClick:function(){
                    this.setState({
                        btn1:'btn btn-xs btn-warning hide',
                        btn2:'btn btn-xs btn-danger ',
                        btn3:'btn btn-xs btn-info ',
                    })
                },
                OnCancelClick:function(){
                    this.setState({
                        btn1:'btn btn-xs btn-warning',
                        btn2:'btn btn-xs btn-danger hide',
                        btn3:'btn btn-xs btn-info hide',
                    })
                },
                
                render:function(){
                    
                    var AllState = this.props.AllState.map(function(text,i){
                        return(
                            <tr key={i} index={i}>
                                <th>{text.id}</th>
                                <td>{text.location_name}</td>
                                <td>{text.active==1?'Active':'De-active'}</td>
                                <td>
                                    <button onClick={() => this.props.ChangeAppMode('Edit',text.id)} className="btn btn-xs btn-warning">Edit</button>
                                    <button onClick={this.OnDeleteClick} className={this.state.btn1}>Delete</button>
                                    <button className={this.state.btn2}>Are You Sure</button>
                                    <button onClick={() => this.props.ChangeAppMode('Delete',text.id)} className={this.state.btn2}>Yes</button>
                                    <button onClick={this.OnCancelClick} className={this.state.btn3}>No</button>
                                </td>
                            </tr>
                        )
                    }.bind(this));
                    return(
                        !AllState.length
                        ? <div className='alert alert-danger'>No State Found</div>
                        :
                        <table className="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>State Name</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                             {AllState}
                            </tbody>
                        </table>
                    )
                }
            });
            var ReadState = React.createClass({
                getInitialState:function(){
                    return({
                        States:[],
                    })
                },
                componentDidMount(){
                    $.ajax({
                        url: "http://localhost/oceangreen/admin/api/readState.php",
                        type : "GET",
                        cache: false,
                        success: function(html)
                            {
                                this.setState({States:JSON.parse(html)});
                                //alert("first"+this.state.States);
                            }.bind(this),
                    });
                },

                render:function(){
                    return(
                        <div className="panel panel-primary">
                            <div className="panel-heading">
                                Showing States
                                <button onClick={()=> this.props.ChangeAppMode('Create',null)} type="button" className="btn btn-info btn-xs pull-right">Add New State</button>
                                </div>
                            <div className="panel-body">
                                <ShowAllState AllState={this.state.States} ChangeAppMode={this.props.ChangeAppMode}/>
                            </div>
                        </div>
                    );
                },


            });

            var CreateState = React.createClass({
                getInitialState:function(){
                    return({
                        StateName:'',
                        Status:'',
                        Error:'',
                        Success:'',
                    })
                },
                StateNameChange:function(e){
                    this.setState({StateName:e.target.value})
                },
                
                Save:function(){
                   
                    if(this.state.StateName ){
                        this.setState({Error:''});
                    }else{
                        this.setState({Error:'You must enter a #state Name'});
                        return false;
                    }

                    //alert("Statename is "+this.state.StateName );
                   
                    //Ajax call
                    var dataString = 'StateName='+ this.state.StateName;
                    //alert(dataString);
                       
                       $.ajax
                            ({
                            type: "POST",
                            url: "http://localhost/oceangreen/admin/api/AddNewState.php",
                            data: dataString,
                            cache: false,
                            success: function(html)
                            {
                                //alert(html);
                                if(html=='Success'){
                                    this.setState({Success: this.state.StateName+' is Added Successfully',
                                                    Error:'',
                                                    StateName:''})
                                                
                                }
                                if(html=='Available'){
                                    this.setState({Error:this.state.StateName+' is already Available',
                                                    Success:'',})
                                }
                                if(html=='SystemDead'){
                                    this.setState({Error:'Something Went Wrong'})
                                }
                                
                               
                            
                            }.bind(this),
                            });
                },
                render:function(){
                    return(
                        <div className="panel panel-primary">
                            <div className="panel-heading">
                                Create New State
                            </div>
                            <div className="panel-body">
                                <div className="col-md-6">
                                    {this.state.Error
                                        ?<div className='alert alert-danger'>{this.state.Error}</div>
                                        :null
                                    }
                                    {this.state.Success
                                        ?<div className='alert alert-success'>{this.state.Success}</div>
                                        :null
                                    }
                                    <form>
                                            <div className="form-group">
                                                <label for="Statename">State Name</label>
                                                <input onChange={this.StateNameChange}type="text" className="form-control" id="StateName" placeholder="State Name"/>
                                            </div>
                                            
                                            <div className="form-group">
                                                    <button onClick={this.Save}type="button" className="btn btn-primary btn-sm">Create New State</button>
                                                    <button onClick={()=>this.props.ChangeAppMode('Read',null)} type="button" className="btn btn-default btn-sm">Cancel</button>
                                            </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )
                }
            });

        
            var StartPage = React.createClass({
                getInitialState:function(){
                    return({
                        AppMode:'Read',
                        StateId:'',
                    })
                },

                ChangeAppMode:function(text,StateId){
                    
                    this.setState({AppMode:text})
                    if(StateId){
                        this.setState({StateId:StateId})
                    }else{
                        this.setState({StateId:'',})
                    }
                    //alert("AppMode is "+this.state.AppMode+" StateId is"+this.state.StateId);
                },
                render:function(){
                    var ToRender = <ReadState ChangeAppMode={this.ChangeAppMode}/>;
                    switch (this.state.AppMode) {
                        case 'Create': ToRender = <CreateState ChangeAppMode={this.ChangeAppMode}/>;
                            break;
                        case 'Edit'  : ToRender = <EditState ChangeAppMode={this.ChangeAppMode} StateId={this.state.StateId}/>;
                            break;
                        case 'Delete': ToRender = <DeleteState ChangeAppMode={this.ChangeAppMode } StateId={this.state.StateId}/>;
                        default:
                            break;
                    }
                    return (
                        <div>
                                {<Nevigation/>}
                            <div className="container">
                                <div className="row">
                                    <div className="col-md-8 col-md-offset-2">
                                        {ToRender}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )
                        
                }
            });
            ReactDOM.render(<StartPage/>,document.getElementById('CmsApp'));
        </script>
    </body>
</html>